# Video.js Plugin Conventions

This document outlines conventions used internally at [Brightcove][bcov] in developing both open-source and proprietary plugins for [Video.js][vjs].

_These rules are by no means required for community plugins._ You can write plugins in whichever way you choose. However, these rules _are recommended_, as the Video.js organization wants to foster consistency within the Video.js ecosystem.

This document and [the Yeoman generator][generator] it is part of are provided as open-source for the good of the community. If you don't agree with these conventions, by all means follow your preferences in your plugin projects!

### Table of Contents

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [Rules Summary](#rules-summary)
- [Packaging and Dependencies](#packaging-and-dependencies)
  - [Structure](#structure)
    - [Optional?](#optional)
    - [Generated?](#generated)
- [Automation](#automation)
  - [npm Core Scripts](#npm-core-scripts)
- [Coding Style](#coding-style)
- [Testing](#testing)
  - [Writing Tests](#writing-tests)
  - [Testing in a Browser](#testing-in-a-browser)
- [Release](#release)
  - [Versioning](#versioning)
  - [Publishing](#publishing)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Rules Summary

All conventional Video.js plugins _must_:

- ...be npm packages.
- ...have automation available through npm scripts.
- ...implement the core set of npm scripts.
- ...be written in ES6 and pass `videojs-standard` linting.
- ...have tests.
- ...never check build artifacts into `master` branch (or equivalent) history the repository.

## Packaging and Dependencies

__All conventional Video.js plugins must be npm packages.__

Plugins should be as self-contained as possible, so the only dependency (`"dependencies"` in `package.json`) by default is Video.js, which is not included in the final bundled assets.

### Structure

Folder/Filename            | Optional? | Generated? | Description
-------------------------- | --------- | ---------- | -----------
`dist/`                    |           |            | Created during builds, ignored by Git.
`dist/browser/`            |           |            | Packaged assets for use in a browser/`<script>` tag.
`dist/docs/`               | ✓         |            | Packaged documentation.
`dist/es5/`                |           |            | Transpiled assets for ES5 consumers (e.g. Node, Browserify).
`dist/lang/`               | ✓         |            | Compiled language assets.
`docs/`                    | ✓         | ?          | Any documentation beyond `README.md`.
`docs/index.md`            | ✓         | ?          | An index for additional documentation.
`lang/`                    | ✓         | ?          | Any JSON language files for the plugin.
`src/`                     |           | ✓          | All source code.
`src/css/`                 | ✓         | ?          | Sass source code/partials.
`src/css/index.scss`       | ✓         | ?          | Sass _entry point_.
`src/js/`                  |           | ✓          | JavaScript source code.
`src/js/index.js`          |           | ✓          | Browserify _entry point_.
`test/`                    |           | ✓          | Unit tests.
`test/index.test.js`       |           | ✓          | Browserify _entry point_ for tests.
`.editorconfig`            | ✓         | ✓          |
`.gitignore`               |           | ✓          |
`.npmignore`               |           | ✓          |
`bower.json`               | ✓         | ?          |
`CHANGELOG.md`             |           | ✓          |
`CONTRIBUTING.md`          | ✓         | ✓          | Documents how developers can work on the plugin.
`index.html`               |           | ✓          | An example of usage of the plugin. This can be used with GitHub pages as well.
`LICENSE`                  | ✓         | ?          | Defaults to `MIT`.
`package.json`             |           | ✓          |
`README.md`                |           | ✓          | Documents what the plugin does and how to use it as a general user.

#### Optional?

- ✓: The file/directory is _not required_ to meet the rules in this document.

#### Generated?

Bear in mind, that multiple runs of the generator will prompt you for each conflicting file that exists before overwriting!

- ✓: The file/directory is _always_ generated by the generator.
- ?: The file/directory _may_ be generated, depending on options.
- Otherwise, the file is _never_ generated.

## Automation

__All automation for a conventional Video.js plugin must be available through npm scripts.__

The generator provides npm script automation for all aspects of plugin development. These scripts call out to the [videojs-spellbook][spellbook] project to perform the actual tasks. This separation eliminates the need to repeatedly run the generator when tooling improvements are released.

However, some developers may prefer to implement their build process with a tool like Gulp or Grunt and this is an accepted practice provided [the core set of npm scripts](#npm-core-scripts) are aliased to the appropriate command for your build tool. For example, if you're using `grunt`, your `package.json` might have:

```json
"scripts": {
  "build": "grunt",
  "clean": "grunt clean"
}
```

There are many good reasons to standardize on npm scripts:

- npm provides a unified interface while keeping implementation choices up to the individual developer or team.
- Where a separate build tool is preferred, npm scripts can easily act as aliases to build tasks (e.g., `"start": "gulp start-server"`).
- npm is a common denominator (far more than build tools); so, CI servers, contributors, and tools can use npm without concern for what's "under the hood".
- Consistent npm script naming means contributors don't have to learn a new build tool or new set of commands when moving between plugin projects, lowering the barrier to contributions.

### npm Core Scripts

__All conventional Video.js plugins must implement a core set of npm scripts.__

All names are lower-case. Other scripts (e.g., sub-sub-tasks and `pre*`/`post*` scripts) will be created as well, but these are not documented here as they are not considered core scripts and are subject to change.

npm Script             | Description
---------------------- | -----------
`build`                | Runs all build sub-tasks.
`clean`                | Cleans up _all_ build artifacts.
`lint`                 | Lints all ES6 source file(s) using [videojs-standard][standard].
`start`                | Starts a development server at port `9999` (or closest open port) with live reload and automatic background builds.
`test`                 | Runs `lint`, builds tests, and runs tests in available browsers.
`watch`                | Watches sources for changes and rebuilds as needed. Also, runs as part of `start`.
`version`              | [see below](#versioning)

## Coding Style

__All conventional Video.js plugins must pass `videojs-standard` linting.__

In an effort to reduce guess work, improve maintainability, avoid stylistic bikeshedding, and simplify the code review process, we have an ESLint-based linter named [videojs-standard][standard].

Its coding rules are enforced in conventional Video.js plugins via the `npm run lint` command.

_[videojs-standard][standard] assumes all code it evaluates is written in ES6. Therefore, it ignores build artifacts, which are written in ES5._

## Testing

__All conventional Video.js plugins must have tests.__

Testing is a critical element of any software project and it should be done in an environment as similar to production as possible. To that end, Video.js plugin tests should be run in a browser.

Testing is performed with [QUnit][qunit] as the testing framework and [Karma][karma] as the runner.

### Writing Tests

__All scripts containing tests must be named in the format `*.test.js`__

The generator-provided test entry point is `test/index.test.js` (matching `src/js/index.js`). For simple plugins, this is typically sufficient.

For complex plugins with multiple modules/components, it might make sense to break up tests into multiple modules, too. How test modules are split up is really up to the developer, but the recommended practice is to have a test module for each source module. For example:

```
src/js/index.js :: test/index.test.js
src/js/foo.js :: test/foo.test.js
src/js/bar.js :: test/bar.test.js
```

### Testing in a Browser

During development, it may be more convenient to run your tests manually in a browser (i.e. through QUnit directly, not Karma). This can be achieved easily by running a development server with `npm start` and navigating to [`http://localhost:9876/`][tests].

## Release

### Versioning

__Conventional Video.js plugins may support Bower, but must never check in build artifacts to the history of the main branch (e.g. `master`) in Git.__

TODO

### Publishing

Open-source plugins should use the most basic publishing process available - `npm publish` - which should be run after versioning. Closed-source plugins are left to their respective author(s) or organization.


[bcov]: https://www.brightcove.com
[generator]: https://github.com/videojs/generator-videojs-plugin
[karma]: https://karma-runner.github.io/
[qunit]: https://qunitjs.com/
[spellbook]: https://github.com/videojs/spellbook
[standard]: https://www.npmjs.com/package/videojs-standard
[tests]: http://localhost:9876/
[vjs]: http://videojs.com
